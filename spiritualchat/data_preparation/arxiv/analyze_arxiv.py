import json
import collections

def analyze_arxiv(filepath, categories_filepath='prioritized_arxiv_categories.txt'):
    # Initialize counters and sets
    total_articles = 0
    articles_no_category = 0
    category_counter = collections.Counter()
    unique_article_ids = set()
    
    # Read prioritized categories from file
    prioritized_categories = set()
    with open(categories_filepath, 'r') as f:
        for line in f:
            category = line.split(':')[0].strip()
            prioritized_categories.add(category)
    
    # Read and process JSON lines from the main file
    with open(filepath, 'r') as f:
        for line in f:
            article = json.loads(line)
            article_id = article.get('id', None)
            
            if article_id and article_id not in unique_article_ids:
                unique_article_ids.add(article_id)
                total_articles += 1
                
                # Get the categories
                categories = article.get('categories', None)
                
                if not categories:
                    articles_no_category += 1
                else:
                    for category in categories.split(' '):
                        if category in prioritized_categories:
                            category_counter[category] += 1
    
    # Print statistics
    print(f"Total number of unique articles: {total_articles} (100%)")
    total_prioritized_articles = sum(category_counter.values())
    prioritized_percentage = (total_prioritized_articles / total_articles) * 100
    print(f"Total number of unique articles in prioritized categories: {total_prioritized_articles} ({prioritized_percentage:.2f}%)")
    
    no_cat_percentage = (articles_no_category / total_articles) * 100
    print(f"Unique articles with no categories or no 'categories' field: {articles_no_category} ({no_cat_percentage:.2f}%)")
    
    print("Prioritized categories (ordered by popularity):")
    for category, count in category_counter.most_common():
        percentage = (count / total_articles) * 100
        print(f"{category}: {count} ({percentage:.2f}%)")

from fire import Fire
Fire(analyze_arxiv)

# Results:
# Total number of articles: 2340115 (100%)
# Articles with no categories or no 'categories' field: 0 (0.00%)
# Categories (ordered by popularity):
# hep-ph: 174662 (7.46%)
# hep-th: 161050 (6.88%)
# cs.LG: 152362 (6.51%)
# quant-ph: 139582 (5.96%)
# cs.CV: 105785 (4.52%)
# astro-ph: 105380 (4.50%)
# gr-qc: 102621 (4.39%)
# cond-mat.mtrl-sci: 87005 (3.72%)
# cond-mat.mes-hall: 86093 (3.68%)
# math-ph: 75999 (3.25%)
# math.MP: 75999 (3.25%)
# cs.AI: 72009 (3.08%)
# cond-mat.stat-mech: 70619 (3.02%)
# cond-mat.str-el: 70580 (3.02%)
# astro-ph.CO: 64130 (2.74%)
# math.CO: 61942 (2.65%)
# stat.ML: 61265 (2.62%)
# astro-ph.GA: 59881 (2.56%)
# math.AP: 57988 (2.48%)
# astro-ph.SR: 57100 (2.44%)
# nucl-th: 55252 (2.36%)
# astro-ph.HE: 53955 (2.31%)
# math.PR: 53006 (2.27%)
# hep-ex: 51509 (2.20%)
# cs.CL: 50597 (2.16%)
# math.AG: 50040 (2.14%)
# math.OC: 44052 (1.88%)
# cs.IT: 44026 (1.88%)
# math.IT: 44026 (1.88%)
# physics.optics: 43136 (1.84%)
# cond-mat.supr-con: 41710 (1.78%)
# math.DG: 40132 (1.71%)
# math.NT: 39432 (1.69%)
# cond-mat.soft: 37943 (1.62%)
# math.NA: 34593 (1.48%)
# math.DS: 34405 (1.47%)
# math.FA: 29376 (1.26%)
# cs.CR: 28900 (1.23%)
# cs.SY: 27832 (1.19%)
# cs.RO: 27207 (1.16%)
# astro-ph.EP: 27096 (1.16%)
# hep-lat: 27053 (1.16%)
# astro-ph.IM: 26909 (1.15%)
# physics.flu-dyn: 26013 (1.11%)
# nucl-ex: 24852 (1.06%)
# math.RT: 24776 (1.06%)
# stat.ME: 24213 (1.03%)
# eess.SP: 24022 (1.03%)
# cond-mat.dis-nn: 22663 (0.97%)
# cs.DS: 22471 (0.96%)
# math.GT: 21772 (0.93%)
# math.ST: 21475 (0.92%)
# stat.TH: 21475 (0.92%)
# physics.comp-ph: 21195 (0.91%)
# math.CA: 21179 (0.91%)
# math.GR: 21017 (0.90%)
# physics.soc-ph: 20904 (0.89%)
# cs.NA: 20615 (0.88%)
# physics.chem-ph: 20507 (0.88%)
# cs.NI: 20484 (0.88%)
# physics.atom-ph: 20153 (0.86%)
# cond-mat.quant-gas: 20066 (0.86%)
# eess.IV: 20050 (0.86%)
# physics.ins-det: 19852 (0.85%)
# cs.DC: 19515 (0.83%)
# eess.SY: 19382 (0.83%)
# math.QA: 18352 (0.78%)
# cs.SI: 18349 (0.78%)
# stat.AP: 16930 (0.72%)
# math.RA: 16456 (0.70%)
# cs.CY: 16223 (0.69%)
# math.CV: 16179 (0.69%)
# physics.app-ph: 16168 (0.69%)
# physics.plasm-ph: 15516 (0.66%)
# cond-mat.other: 15292 (0.65%)
# nlin.CD: 15197 (0.65%)
# cs.LO: 15080 (0.64%)
# cs.IR: 14912 (0.64%)
# math.AT: 14797 (0.63%)
# cs.HC: 14450 (0.62%)
# physics.bio-ph: 14438 (0.62%)
# cs.SE: 14411 (0.62%)
# cond-mat: 14215 (0.61%)
# cs.NE: 13097 (0.56%)
# eess.AS: 12609 (0.54%)
# cs.DM: 12571 (0.54%)
# math.LO: 12454 (0.53%)
# math.AC: 12244 (0.52%)
# cs.SD: 12213 (0.52%)
# math.OA: 12074 (0.52%)
# nlin.SI: 11509 (0.49%)
# q-bio.PE: 10847 (0.46%)
# math.MG: 10573 (0.45%)
# cs.GT: 10381 (0.44%)
# physics.gen-ph: 10143 (0.43%)
# cs.CC: 10122 (0.43%)
# physics.data-an: 9876 (0.42%)
# q-bio.QM: 9584 (0.41%)
# nlin.PS: 9336 (0.40%)
# math.SP: 9208 (0.39%)
# q-bio.NC: 8750 (0.37%)
# math.SG: 8669 (0.37%)
# physics.class-ph: 8189 (0.35%)
# cs.DB: 7992 (0.34%)
# math.CT: 7984 (0.34%)
# stat.CO: 7608 (0.33%)
# physics.acc-ph: 7399 (0.32%)
# cs.PL: 7192 (0.31%)
# nlin.AO: 6848 (0.29%)
# cs.MA: 6768 (0.29%)
# physics.geo-ph: 6602 (0.28%)
# cs.CG: 6421 (0.27%)
# physics.med-ph: 6284 (0.27%)
# cs.CE: 6146 (0.26%)
# physics.space-ph: 5990 (0.26%)
# physics.ao-ph: 5879 (0.25%)
# math.KT: 5647 (0.24%)
# cs.MM: 5622 (0.24%)
# cs.GR: 5138 (0.22%)
# q-bio.BM: 5120 (0.22%)
# math.GN: 4879 (0.21%)
# physics.hist-ph: 4692 (0.20%)
# cs.FL: 4633 (0.20%)
# cs.DL: 4543 (0.19%)
# cs.AR: 4212 (0.18%)
# q-fin.EC: 3990 (0.17%)
# math.GM: 3748 (0.16%)
# cs.ET: 3661 (0.16%)
# physics.ed-ph: 3629 (0.16%)
# cs.PF: 3615 (0.15%)
# q-bio.MN: 3582 (0.15%)
# math.HO: 3435 (0.15%)
# econ.GN: 3423 (0.15%)
# q-fin.ST: 3371 (0.14%)
# econ.EM: 3126 (0.13%)
# q-bio.GN: 2938 (0.13%)
# physics.atm-clus: 2646 (0.11%)
# q-fin.GN: 2543 (0.11%)
# chao-dyn: 2398 (0.10%)
# cs.SC: 2381 (0.10%)
# physics.pop-ph: 2323 (0.10%)
# q-fin.MF: 2320 (0.10%)
# q-fin.CP: 2199 (0.09%)
# cs.OH: 2168 (0.09%)
# q-bio.TO: 2117 (0.09%)
# cs.MS: 2096 (0.09%)
# q-fin.RM: 2096 (0.09%)
# econ.TH: 2070 (0.09%)
# q-bio.CB: 2064 (0.09%)
# q-fin.PR: 1897 (0.08%)
# q-fin.PM: 1713 (0.07%)
# q-bio.SC: 1651 (0.07%)
# q-fin.TR: 1641 (0.07%)
# q-alg: 1578 (0.07%)
# nlin.CG: 1455 (0.06%)
# alg-geom: 1423 (0.06%)
# solv-int: 1413 (0.06%)
# q-bio: 1356 (0.06%)
# stat.OT: 1240 (0.05%)
# q-bio.OT: 1194 (0.05%)
# cmp-lg: 894 (0.04%)
# cs.OS: 816 (0.03%)
# dg-ga: 732 (0.03%)
# patt-sol: 650 (0.03%)
# adap-org: 584 (0.02%)
# funct-an: 427 (0.02%)
# mtrl-th: 262 (0.01%)
# chem-ph: 251 (0.01%)
# comp-gas: 221 (0.01%)
# cs.GL: 208 (0.01%)
# supr-con: 175 (0.01%)
# atom-ph: 123 (0.01%)
# acc-phys: 49 (0.00%)
# plasm-ph: 38 (0.00%)
# ao-sci: 17 (0.00%)
# bayes-an: 16 (0.00%)